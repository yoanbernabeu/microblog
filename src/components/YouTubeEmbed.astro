---
interface Props {
  videoId: string;
  title?: string;
}

const { videoId, title = 'Video YouTube' } = Astro.props;
const thumbnailUrl = `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`;
---

<div class="mt-4 relative rounded-xl overflow-hidden bg-surface-100 dark:bg-surface-800 aspect-video max-w-md group/yt">
  <!-- Thumbnail avec bouton play (chargement differe) -->
  <button
    type="button"
    class="youtube-facade w-full h-full"
    data-youtube-id={videoId}
    aria-label={`Lire la video : ${title}`}
  >
    <img
      src={thumbnailUrl}
      alt={title}
      class="w-full h-full object-cover"
      loading="lazy"
    />
    <div class="absolute inset-0 flex items-center justify-center bg-gradient-to-t from-black/40 to-transparent group-hover/yt:from-black/50 transition-all duration-300">
      <div class="w-14 h-14 flex items-center justify-center rounded-full bg-red-600 text-white shadow-lg group-hover/yt:scale-110 transition-transform duration-300">
        <svg class="w-6 h-6 ml-0.5" fill="currentColor" viewBox="0 0 24 24">
          <path d="M8 5v14l11-7z" />
        </svg>
      </div>
    </div>
  </button>
</div>

<script>
  function initYouTubeFacades() {
    document.querySelectorAll('.youtube-facade').forEach(button => {
      button.addEventListener('click', () => {
        const videoId = button.getAttribute('data-youtube-id');
        if (!videoId) return;

        const iframe = document.createElement('iframe');
        iframe.src = `https://www.youtube-nocookie.com/embed/${videoId}?autoplay=1`;
        iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
        iframe.allowFullscreen = true;
        iframe.className = 'absolute inset-0 w-full h-full';

        const container = button.parentElement;
        if (container) {
          container.innerHTML = '';
          container.appendChild(iframe);
        }
      });
    }, { once: true });
  }

  initYouTubeFacades();
  document.addEventListener('astro:after-swap', initYouTubeFacades);
</script>
